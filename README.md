# Сервис разбиения стерео аудио файлов

## Описание:

Сервис реализует разбиение стерео аудио-файлов на 2 файла по каналам.
Создаваемые файлы сохраненяются в s3 хранилище. Ссылки на полученные файлы пользователь может получить через интерфейс REST API, а также реализована фоновая обработка задач по разбиению файлов через очереди RabbitMQ.
История обращений к REST API сохраняется в базу данных. Записи содержат переданную ссылку (`link`), время обращения (`created_at`) и результат обработки (`is_done`): булево значение, True в случае успешной обработки, False - при возникновении ошибки.
Также реализована возможность запуска нескольких экземпляров приложения через gunicorn.

## Как запустить проект локально:

### Клонировать репозиторий и перейти в него:

```sh
git clone https://github.com/Rezenhorn/split_audio_app.git
```

```sh
cd split_audio_app/
```

### В файле конфигурации приложения `split_audio_app/config.yaml` указать данные вашего s3 хранилища (endpoint, bucket, aws_server_public_key, aws_server_secret_key).

### Убедиться, что в системе установлен и запущен Docker.

### Запустить приложение через docker-compose:


```sh
docker-compose up -d --build
```

### Проект станет доступен по адресу <http://localhost:5050/>. Доступ к веб-интерфейсу RabbitMQ: <http://localhost:15672/>

## Спецификация REST API

### Разбиение аудиофайла по ссылке

**Метод и URL запроса**

`POST → http://localhost:5050/api/v1/split_audio`

**Параметры запроса**

В теле запроса в формате JSON должна передаваться ссылка на скачивание стерео аудиофайла, который необходимо разбить.

В запросе необходимо использовать заголовок Content-Type: application/json

**Пример запроса**

```json
{
  "link": "<ссылка на файл>"
}
```

**Ответ на запрос**

```json
{
  "status": "success",
  "result": {
    "left_mono": "<ссылка на скачивание левого канала>",
    "right_mono": "<ссылка на скачивание правого канала>"
  }
}
```

## Работа с RabbitMQ

Для использования обработки сообщений через RabbitMQ, необходимо в очередь `tasks` (названия очередей можно поменять в `config.yaml`) отправить сообщение с ссылкой на айдиофайл в формате JSON, аналогичное запросу через REST API.
В случае успешной обработки, результат отправляется в очередь `results`.
